CREATE TABLESPACE ts1;
CREATE TABLE t1 (
id INT PRIMARY KEY,
make_big CHAR(200),
val LONGBLOB
) TABLESPACE ts1;
CREATE TABLE t2 (
id INT PRIMARY KEY,
make_big CHAR(200),
val LONGBLOB
) TABLESPACE ts1;
INSERT INTO t1 (id,val) VALUES (1,REPEAT('a',1000000));
INSERT INTO t2 (id,val) VALUES (1,REPEAT('a',1000000));
INSERT INTO t1 (id,val) VALUES (2,REPEAT('a',1000000));
INSERT INTO t2 (id,val) VALUES (2,REPEAT('a',1000000));
INSERT INTO t1 (id,val) VALUES (3,REPEAT('a',1000000));
INSERT INTO t2 (id,val) VALUES (3,REPEAT('a',523809));
BEGIN;
UPDATE t2 SET val = REPEAT('b',10000) WHERE id=3;
SET DEBUG_SYNC=
'ib_blob_update_rollback_will_reserve
    SIGNAL con1_will_reserve
    WAIT_FOR con1_can_reserve';
ROLLBACK;
SET DEBUG_SYNC='now WAIT_FOR con1_will_reserve';
BEGIN;
INSERT INTO t1 (id,val) VALUES (4000,REPEAT('b',1000000));
SET DEBUG_SYNC='now SIGNAL con1_can_reserve';
ROLLBACK;
DROP TABLE t1;
DROP TABLE t2;
DROP TABLESPACE ts1;
