CREATE SCHEMA xtest;
CREATE TABLE xtest.data(val VARCHAR(256));
SET GLOBAL mysqlx_compression_algorithms='DEFLATE_STREAM,LZ4_MESSAGE,ZSTD_STREAM';
SET GLOBAL mysqlx_zstd_max_client_compression_level=22;

Verify ZSTD_STREAM at level 1
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 1]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 2
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 2]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 3
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 3]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 4
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 4]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 5
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 5]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 6
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 6]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 7
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 7]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 8
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 8]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 9
=============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 9]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 10
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 10]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 11
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 11]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 12
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 12]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 13
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 13]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 14
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 14]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 15
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 15]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 16
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 16]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 17
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 17]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 18
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 18]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 19
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 19]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 20
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 20]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 21
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 21]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level 22
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of 22]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -1
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -1]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -2
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -2]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -3
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -3]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -4
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -4]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -5
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -5]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -6
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -6]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -7
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -7]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -8
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -8]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -9
==============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -9]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -10
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -10]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -11
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -11]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -12
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -12]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -13
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -13]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -14
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -14]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -15
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -15]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -16
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -16]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -17
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -17]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -18
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -18]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -19
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -19]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -20
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -20]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -21
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -21]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok

Verify ZSTD_STREAM at level -22
===============================
Verify [Status variable "Mysqlx_compression_level" needs to have a value of -22]
Verify [Status variable "Mysqlx_bytes_received_compressed_payload" needs to be lower than "Mysqlx_bytes_received_uncompressed_frame"]
Mysqlx.Ok {
  msg: "bye!"
}
ok
DROP SCHEMA xtest;
SET GLOBAL mysqlx_zstd_max_client_compression_level=DEFAULT;
SET GLOBAL mysqlx_compression_algorithms=DEFAULT;
